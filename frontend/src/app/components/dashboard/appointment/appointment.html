<!-- appointment-form.component.html -->
<main class="edit-layout">
  <section class="card edit-form-card">
    <div class="form-header-row">
      <div>
        <h2 class="form-title">{{ getFormTitle() }}</h2>
        @if (actualRoute === 'edit' && getAppointmentId()) {
          <p class="subtitle">ID de Cita: #{{ getAppointmentId() }}</p>
        }
      </div>
      @if (actualRoute === 'edit' && getAppointmentStatus()) {
        <span class="badge" [class]="getAppointmentStatus().toLowerCase()">
          {{ getAppointmentStatus() }}
        </span>
      }
    </div>

    @if (actualRoute === 'edit') {
      <div class="info-alert">
        <i class="bx bx-info-circle"></i>
        <p>
          Nota: Reprogramar la cita con menos de 24 horas de antelación puede generar cargos
          adicionales.
        </p>
      </div>
    }

    <form class="edit-form" (ngSubmit)="onSubmit()" #appointmentForm="ngForm">
      <div class="form-group full-width">
        <label>Paciente</label>
        <div class="input-readonly-wrapper">
          <i class="bx bx-user"></i>
           <input type="text" [value]="getPatientName()" readonly />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Doctor Asignado</label>
          <select
            [(ngModel)]="formData.doctorId"
            name="doctorId"
            required
            (change)="onDoctorChange()"
          >
            @if (actualRoute === 'edit' && formData.doctorId) {
              @for (doctor of doctors; track doctor.id) {
                @if (doctor.id.toString() === formData.doctorId.toString()) {
                  <option [value]="doctor.id" selected>Dr. {{ doctor.name }} {{ doctor.lastname }}</option>
                }
              }
            } @else {
              <option value="" disabled selected>Seleccionar doctor</option>
              @for (doctor of doctors; track doctor.id) {
                <option [value]="doctor.id">Dr. {{ doctor.name }} {{ doctor.lastname }}</option>
              }
            }
          </select>
        </div>
        <div class="form-group">
          <label>Especialidad</label>
          <select
            [(ngModel)]="formData.specialtyId"
            name="specialtyId"
            required
            [disabled]="!formData.doctorId"
          >
            <option value="">Seleccionar especialidad</option>
            @for (spec of filteredSpeciality; track spec) {
              <option [value]="spec.id">{{ spec.name }}</option>
            }
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>{{ actualRoute === 'edit' ? 'Nueva Fecha' : 'Fecha' }}</label>
          <input
            type="date"
            [(ngModel)]="formData.date"
            name="date"
            required
            [min]="actualRoute === 'create' ? getTomorrowDate() : ''"
          />
        </div>

        <div class="form-group">
  <label>{{ actualRoute === 'edit' ? 'Nuevo Horario' : 'Seleccionar Horario' }}</label>

  <div class="form-group">
  <select>
    @for (slot of timeSlots; track slot) {
      <option class="time-slot" [class.selected]="isSlotSelected(slot)" (click)="selectTimeSlot(slot)">
      {{ slot.start }} - {{ slot.end }}
     </option>
    }
  </select>

  </div>

  <input type="hidden" [(ngModel)]="formData.selectedSlot" name="selectedSlot">
</div>
      </div>

      <div class="form-group full-width">
        <label>Motivo / Notas adicionales</label>
        @if (actualRoute === 'edit') {
          <textarea
            rows="4"
            [(ngModel)]="formData.reason"
            name="reason"
            placeholder="Describe brevemente tus síntomas o la razón de la visita..."
          ></textarea>
        } @else {
          <textarea
            rows="4"
            [(ngModel)]="formData.reason"
            name="reason"
            placeholder="Describe brevemente tus síntomas o la razón de la visita..."
          ></textarea>
        }
      </div>

      <div class="form-actions-edit">
        @if (actualRoute === 'edit') {
          <button type="button" class="btn-danger-text" (click)="onCancel()">
            <i class="bx bx-trash"></i> Cancelar esta Cita
          </button>
        }

        <div class="right-buttons">
          <button type="button" class="btn-cancelar" (click)="redirectToHome()">
            Volver
          </button>
          <button type="submit" class="btn-guardar" [disabled]="!appointmentForm.form.valid">
            <i class="bx bx-save"></i>
            {{ actualRoute === 'edit' ? 'Guardar Cambios' : 'Crear Cita' }}
          </button>
        </div>
      </div>
    </form>
  </section>
</main>
